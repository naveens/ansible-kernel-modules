---
- name: unload blacklisted modules
  modprobe: name={{item}} state=absent
  with_items: "{{blacklisted_modules}}"
  sudo: true

- name: unload disabled modules
  modprobe: name={{item}} state=absent
  with_items: "{{disabled_modules}}"
  sudo: true

- name: mkdir /etc/modprobe.d
  file: path=/etc/modprobe.d state=directory
  sudo: true

- name: create conf file
  template: src=modprobe.conf dest={{modules_file}}
  sudo: true
